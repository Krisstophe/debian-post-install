#!/usr/bin/python2
#coding: utf-8

def prettifyhtmlfile(fn):
    import codecs
    import bs4
    encodings = ["utf-8", "gb18030", "gbk", "latin-1", "nothing"];
    s = ""
    currentencoding = "";
    for enc in encodings:
        currentencoding = enc;
        try:
            with codecs.open(fn, "r", currentencoding) as f:
                s = f.readlines()
                break
        except UnicodeDecodeError:
            print "Decode failed : " + currentencoding
            pass
        except:
            break
    print "Decode done   : " + currentencoding
    soup = bs4.BeautifulSoup(''.join(s))
    res = soup.prettify()
    with codecs.open("pretty_"+fn, "w", currentencoding) as f:
        f.write(res)

import sys
if (len(sys.argv)>1):
    prettifyhtmlfile(sys.argv[1])
else:
    print "usage: pretty <html-filename>"
