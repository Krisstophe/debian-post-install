#!/bin/sh

# 全文查询数字串、文本串
# 根据数字查询时，严格过滤，如搜索123则4123不应该出现

logfile="findpass.log"

if [ "$1" == "-n" ]; then
	para1="num"
elif [ "$1" == "-s" ]; then
	para1="str"
else
	echo "usage: findpass.sh -n/-s [number/string]"
	exit
fi

echo ">>> `date`" >> ${logfile}
echo ">>> findpass.sh $1 $2" >> ${logfile}

if [ "$1" == "-n" ]; then
	time find . -regextype egrep -iregex '^.*\.(txt|sql|php|htm|html)$' \
	-printf "'%p' " \
	| xargs grep -E "^(|.*[^0-9])$2([^0-9].*|)$" - \
	| tee -a ${logfile}
elif [ "$1" == "-s" ]; then
	time find . -regextype egrep -iregex '^.*\.(txt|sql|php|htm|html)$' \
	-printf "'%p' " \
	| xargs grep -E "^.*$2.*$" - \
	| tee -a ${logfile}
fi

# 有时处理汉字编码有问题，使用gnuwin32的grep程序，不会乱码
# 但有的文档本身就含混合编码，回天乏力
# 另：gnuwin32的grep实际效率只有cygwin的grep的1/10，time命令实测
# find . -iname '*.txt' -printf "'%p' " \
#	| xargs "/c/Program Files/GnuWin32/bin/grep.exe" \
#	-E "^(|.*[^0-9])$22-9].*|)\$" - \
#	| tee -a ${logfile}

echo ">>> `date`" >> ${logfile}
echo >> ${logfile}
echo >> ${logfile}

echo Log: ${logfile}, Press ENTER to leave...
read
